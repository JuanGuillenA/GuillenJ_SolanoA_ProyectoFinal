<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
      http://jasperreports.sourceforge.net/jasperreports 
      http://jasperreports.sourceforge.net/xsd/jasperreport.xsd"
    name="ocupacion_especialidad" pageWidth="595" pageHeight="842"
    columnWidth="515" leftMargin="40" rightMargin="40"
    topMargin="50" bottomMargin="50">

  <!-- Parámetros -->
  <parameter name="FechaDesde" class="java.time.LocalDate"/>
  <parameter name="FechaHasta" class="java.time.LocalDate"/>

  <!-- Campos: tu entidad Cita -->
  <field name="medico"   class="ec.edu.ups.citas.modelo.Medico"/>
  <field name="paciente" class="ec.edu.ups.citas.modelo.Usuario"/>
  <field name="fecha"    class="java.time.LocalDate"/>
  <field name="hora"     class="java.time.LocalTime"/>
  <field name="estado"   class="ec.edu.ups.citas.modelo.Estado"/>

  <!-- Variable: cuenta citas por especialidad -->
  <variable name="TotalCitas" class="java.lang.Integer" calculation="Count">
    <variableExpression><![CDATA[
      $F{medico}.getEspecialidad().getNombre()
    ]]></variableExpression>
  </variable>

  <title>
    <band height="50">
      <staticText>
        <reportElement x="0" y="10" width="515" height="30"/>
        <textElement textAlignment="Center">
          <font size="16" isBold="true"/>
        </textElement>
        <text><![CDATA[Reporte de Citas por Especialidad]]></text>
      </staticText>
    </band>
  </title>

  <columnHeader>
    <band height="20">
      <staticText><reportElement x="0"  y="0" width="150" height="20"/>
        <text><![CDATA[Médico]]></text>
      </staticText>
      <staticText><reportElement x="150" y="0" width="150" height="20"/>
        <text><![CDATA[Paciente]]></text>
      </staticText>
      <staticText><reportElement x="300" y="0" width="80" height="20"/>
        <text><![CDATA[Fecha]]></text>
      </staticText>
      <staticText><reportElement x="380" y="0" width="80" height="20"/>
        <text><![CDATA[Hora]]></text>
      </staticText>
      <staticText><reportElement x="460" y="0" width="55" height="20"/>
        <text><![CDATA[Estado]]></text>
      </staticText>
    </band>
  </columnHeader>

  <!-- Grupo por Especialidad -->
  <group name="EspGroup">
    <groupExpression>
      <![CDATA[$F{medico}.getEspecialidad().getNombre()]]>
    </groupExpression>
    <groupHeader>
      <band height="20">
        <textField>
          <reportElement x="0" y="0" width="515" height="20"/>
          <textFieldExpression>
            <![CDATA["Especialidad: " 
               + $F{medico}.getEspecialidad().getNombre()]]>
          </textFieldExpression>
        </textField>
      </band>
    </groupHeader>
    <groupFooter>
      <band height="20">
        <staticText>
          <reportElement x="350" y="0" width="100" height="20"/>
          <text><![CDATA[Total Citas:]]></text>
        </staticText>
        <textField>
          <reportElement x="460" y="0" width="55" height="20"/>
          <textFieldExpression><![CDATA[$V{TotalCitas}]]></textFieldExpression>
        </textField>
      </band>
    </groupFooter>
  </group>

  <!-- Detalle -->
  <detail>
    <band height="20">
      <textField>
        <reportElement x="0" y="0" width="150" height="20"/>
        <textFieldExpression>
          <![CDATA[
            $F{medico}.getNombre() 
            + " " 
            + $F{medico}.getApellido()
          ]]>
        </textFieldExpression>
      </textField>
      <textField>
        <reportElement x="150" y="0" width="150" height="20"/>
        <textFieldExpression>
          <![CDATA[$F{paciente}.getDisplayName()]]>
        </textFieldExpression>
      </textField>
      <textField>
        <reportElement x="300" y="0" width="80" height="20"/>
        <textFieldExpression><![CDATA[$F{fecha}.toString()]]></textFieldExpression>
      </textField>
      <textField>
        <reportElement x="380" y="0" width="80" height="20"/>
        <textFieldExpression><![CDATA[$F{hora}.toString()]]></textFieldExpression>
      </textField>
      <textField>
        <reportElement x="460" y="0" width="55" height="20"/>
        <textFieldExpression><![CDATA[$F{estado}.name()]]></textFieldExpression>
      </textField>
    </band>
  </detail>
</jasperReport>
